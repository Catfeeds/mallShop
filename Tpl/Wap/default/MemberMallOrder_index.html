<include file="Public:S5NewHead" />
<!--页面css-->
<link rel="stylesheet" type="text/css" href="{lanrain::RES}/new_eshop/css/wap.css?<?php echo C('site_system_file_version');?>">
<section class="neweshop-ctt ifoot_padding Scrm_index_content neweshop-bottom-51">
	<div class="Order-classification">
		<i class="Order-tab-icon"></i>
		<div class="Order-tab-box">
			<ul class="Order-tab-ul">
				<li data-type="" class="active" data-count="<?php echo $count;?>">全部</li>
				<li data-type="1" data-count="<?php echo $count1;?>">待付款</li>
				<li data-type="2" data-count="<?php echo $count2;?>">待发货</li>
				<li data-type="3" data-count="<?php echo $count3;?>">已发货</li>
				<li data-type="4" data-count="<?php echo $count4;?>">已签收</li>
				<li data-type="8" data-count="<?php echo $count8;?>">退货</li>
			</ul>
		</div>
	</div>
	<!-- 全部 -->
	<div class="Order-ul js-moreOrder" style="display: block;">
		<?php if($list){ foreach($list as $key=>$val){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span><?php if($val['orderstatus']==1){ echo '待付款';}elseif($val['orderstatus']==2){ echo '待发货';}elseif($val['orderstatus']==3){ echo '已发货';}elseif($val['orderstatus']==4){ echo '已签收';}elseif($val['orderstatus']==5){ echo '已取消';}elseif($val['orderstatus']==7){ echo '确认到账中';}elseif($val['orderstatus']==8){ echo '退货';}elseif($val['orderstatus']==11){ echo '待成团';};?></span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val['goodtype']==1 && $val['truegoodtype']==2){ foreach($val['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<?php if($val['orderstatus'] == 1){?>
				<a href="<?php echo C('site_url');?>/Payapi/Wxpay/payAct/jsapi.php?orderid=<?php echo $val['orderid'];?>" class="btn Order-gold-btn">立即付款</a>
				<?php }?>
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
				<?php if($val['goodtype']==1 && $val['orderstatus']==3){?>
				<a href="javascript:void(0);" class="btn Order-gold-btn js-editOrderButton" data-id="<?php echo $val['id'];?>" data-orderstatus="4">确认签收</a>
				<?php }?>
				<?php if($val['orderstatus'] == 1){?>
				<a href="javascript:void(0);" class="btn Order-black-btn js-editOrderButton" data-id="<?php echo $val['id'];?>" data-orderstatus="5">取消订单</a>
				<?php }?>
				<?php if($val['orderstatus'] == 11 && $val['groupinfoid'] != ''){?>
				<a href="<?php echo U('MallGroupGoods/index',array('companyid'=>$companyid,'groupinfoid'=>$val['groupinfoid']))?>" class="btn Order-gold-btn" data-id="<?php echo $val['id'];?>">邀请好友参团</a>
				<?php }?>
			</div>
		</div>
		<?php }}?>
	</div>
	<!-- 待付款 -->
	<div class="Order-ul js-moreOrder1">
		<?php if($list1){ foreach($list1 as $key1=>$val1){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span>待付款</span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val1['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val1['goodtype']==1 && $val1['truegoodtype']==2){ foreach($val1['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val1['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val1['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<a href="<?php echo C('site_url');?>/Payapi/Wxpay/payAct/jsapi.php?orderid=<?php echo $val1['orderid'];?>" class="btn Order-gold-btn">立即付款</a>
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val1['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
				<a href="javascript:void(0);" class="btn Order-black-btn js-editOrderButton" data-id="<?php echo $val1['id'];?>" data-orderstatus="5">取消订单</a>
			</div>
		</div>
		<?php }}?>
	</div>
	<!-- 待发货 -->
	<div class="Order-ul js-moreOrder2">
		<?php if($list2){ foreach($list2 as $key2=>$val2){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span>待发货</span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val1['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val2['goodtype']==1 && $val2['truegoodtype']==2){ foreach($val2['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val2['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val2['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val2['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
			</div>
		</div>
		<?php }}?>
	</div>
	<!-- 已发货 -->
	<div class="Order-ul js-moreOrder3">
		<?php if($list3){ foreach($list3 as $key3=>$val3){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span>已发货</span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val3['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val3['goodtype']==1 && $val3['truegoodtype']==2){ foreach($val3['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val3['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val3['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val3['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
				<a href="javascript:void(0);" class="btn Order-gold-btn js-editOrderButton" data-id="<?php echo $val3['id'];?>" data-orderstatus="4">确认签收</a>
			</div>
		</div>
		<?php }}?>
	</div>
	<!-- 已签收 -->
	<div class="Order-ul js-moreOrder4">
		<?php if($list4){ foreach($list4 as $key4=>$val4){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span>已签收</span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val4['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val4['goodtype']==1 && $val4['truegoodtype']==2){ foreach($val4['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val4['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val4['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val4['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
			</div>
		</div>
		<?php }}?>
	</div>
	<!-- 退货 -->
	<div class="Order-ul js-moreOrder8">
		<?php if($list8){ foreach($list8 as $key8=>$val8){?>
		<div class="details-Image-Text">
			<div class="details-Image-Text-head">
				<span>退货</span>
				<div class="details-Text--ml"><a href="javascript:void(0);">订单号：<?php echo $val8['orderid'];?></a></div>
			</div>
			<ul class="good-list-selected Image-Text-ul" style="margin-bottom: 0;">
				<?php if($val8['goodtype']==1 && $val8['truegoodtype']==2){ foreach($val8['mall'] as $mkey=>$mval){?>
				<li>
					<img class="good-img" src="http://www.mobiwind.cn/Tpl/User/default/common/images/default-ticket.jpg">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['name'];?></p>
						<p class="good-size"><!-- 规格：65g/2份 --></p>
						<p class="good-price">￥0.00 <span class="good-num">x1</span></p>
					</div>
				</li>
				<?php }}else{ foreach($val8['mall'] as $mkey=>$mval){?>
				<li>
					<a href="<?php echo U('MallGoods/goodInfo',array('companyid'=>$companyid,'id'=>$mval['goodid']));?>">
					<img class="good-img" src="<?php echo $mval['goodpic'];?>">
					<div class="good-info-cover">
						<p class="good-name"><?php echo $mval['goodname'];?></p>
						<p class="good-size"><?php echo $mval['goodskuname'] ? '规格：'.$mval['goodskuname'] : '';?></p>
						<p class="good-price">￥<?php echo $mval['goodprice'];?> <span class="good-num">x<?php echo $mval['goodnum'];?></span></p>
					</div>
					</a>
				</li>
				<?php }}?>
			</ul>
			<p class="order-nub-p">订单金额:￥<?php echo $val8['orderprice'];?></p>
			<div class="Image-Text-btn-box">
				<a href="<?php echo U('MemberMallOrder/info',array('companyid'=>$companyid,'id'=>$val8['id'],'isshow'=>2));?>" class="btn Order-black-btn">订单详情</a>
			</div>
		</div>
		<?php }}?>
	</div>
	<include file="Public:mallFooter" />
	<!-- ========公共底部======== -->
	<div class="eshopv_fotter_logo">
		<include file="Public:navFooter" />
	</div>
</section>

<script>
// 滑动加载
var orderstatus; //订单状态
var lengthnum = "<?php echo $limit;?>"; //每次加载的数目
var totalnum; //库里面的总数目
var totalpage; //一共要加载多少页
var currentpage = 0; //当前页
$(window).scroll(function () {
	var h2 = $(window).height();
    h1 = $(document).height();
    scollTop = $(document).scrollTop();
    if ((h1 - h2) <= scollTop) {   //滚动条滚到浏览器底部执行的事假
    	orderstatus = $(".active").attr("data-type");
    	totalnum = $(".active").attr("data-count");
		totalpage = Math.ceil(totalnum / lengthnum);  //计算总页数
        if (currentpage == totalpage) {   // 等于总页数
            currentpage = totalpage;
        } else if (currentpage < totalpage) {  // 小于总页数
            currentpage++;
            var startNumber = currentpage * lengthnum;
           	if(currentpage >= totalpage){
                return false;
            }
           	$(".loading").show();
            $.post("<?php echo U('MemberMallOrder/ajaxgetorderlist',array('companyid'=>$companyid)).'&time=';?>"+Math.random(),{orderstatus:orderstatus,startNumber:startNumber},function(data){
    			$('.loading').hide();
    			$('.js-moreOrder'+orderstatus).append(data.html);
    	    },"json");
        }
    }
});
//-------------------- 取消订单、确认签收 --------------------
$(document).on("click", ".js-editOrderButton", function(){
    var id = $(this).attr('data-id');
    var orderstatus = $(this).attr('data-orderstatus');
	$('.loading').show();
    $.post("<?php echo U('MemberMallOrder/ajaxCloseOrder',array('companyid'=>$companyid)).'&time=';?>"+Math.random(),{id:id,orderstatus:orderstatus},function(data){
		$('.loading').hide();
		alert(data.tips, 2000);
		if(data.code == 200){
			setTimeout('window.location.href=location.href',2000);
		}
    },"json");
});
//箭头
var ulw=$(".Order-tab-ul").width();
$(".Order-tab-icon").click(function(){
	$(".Order-tab-box").scrollLeft(ulw/6);
});
//切换div
$(".Order-tab-ul>li").click(function(){
	var index=$(this).index(".Order-tab-ul>li");
	$(this).siblings("li").removeClass("active");
	$(this).addClass("active");
	$(".Order-ul").eq(index).siblings(".Order-ul").hide();
	$(".Order-ul").eq(index).show();
});
</script>
<include file="Public:loading" />
<include file="Public:loginBox" />
<include file="Public:weiXinNotShareSet" />
<include file="Public:footer" />