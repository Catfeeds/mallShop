<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>登录</title>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta content="telephone=no" name="format-detection">
<link href="{lanrain::RES}/css/base.css" rel="stylesheet" type="text/css" />
<!-- Link Swiper's CSS -->
<!--<link rel="stylesheet" href="{lanrain::RES}/css/animate.min.css">-->
<link href="{lanrain::RES}/css/wapcss.css" rel="stylesheet" type="text/css" />
<link href="{lanrain::RES}/css/app.css" rel="stylesheet" type="text/css">
<!-- Demo styles -->
<script src="{lanrain::STATICS}/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="{lanrain::STATICS}/jquery-alert/alert.js" type="text/javascript" ></script>
</head>
<body style="background:#efeff4; position: relative">
<div class="login-deng wow " data-wow-delay="-0.5s">
        <div class="login-login01">
            <ul>
                <li class="login-login02">
                    <img src="{lanrain::RES}/images/7-14-icon.png" >
                    <label><input type="tel" class="form-control"id="importing-tel" name="moblie" placeholder="请输入您的手机号码"></label>
                </li>
                <li>
                    <img src="{lanrain::RES}/images/7-14-icon2.png">
                    <label><input type="password" class="form-control" id="importing-goods" name="password" placeholder="请输入登录密码"></label>
                </li>
            </ul>
        </div>
        <div class="login-login03 login-button2">登录</div>
        <div  class="login-login04">
            <ul>
                <li id="login-wjma" ><a href="javascript:void(0);">忘记密码</a></li>
                <li id="login-zhuc" class="login-zhuce"><a href="#">注册</a></li>
            </ul>
        </div>
        <div class="swiper-pagination swiper-pagination-white" id="zhao-span"></div>
</div>
<!-- 忘记密码 -->
<div class="login-wjma login-wai wow " data-wow-delay="-0.5s">
    <div class="swiper-bj">
        <div class="login-mmxg">
            <ul>
                <li style="border-bottom: 1px solid #e1e1e1 "><label>手机号</label><input type="tel" name="moblie" id="zhmm-moblie" placeholder="请输入您的手机号码"><input type="button" id="wjmm_hqyzm" value="获取验证码"/></li>
                <li style="border-bottom: 1px solid #e1e1e1 "><label>验证码</label><input type="tel" name="moblie" id="zhmm-yym" placeholder="请输入验证码"></li>
                <li><label>新密码</label><input type="password" name="moblie" id="zhmm-pwd" placeholder="请输入新密码"></li>
            </ul>
        </div>
        <div class="login-tj login-button2" id="zhmm-substr">确认提交</div>
        <div class="login-login04">
            <ul>
                <li id="login-yzc" class="login-zhuce"><a href="javascript:void(0); ">已注册？立即登录</a></li>
            </ul>
        </div>
    </div>
</div>
<!-- 注册 -->
<div class="swiper-lizc zhuce-one login-wai wow" data-wow-delay="-0.5s">
    <div class="login-zhuce2">
        <ul>
            <li><label>手机号</label><input type="tel" id="regiMoblie" name="moblie" placeholder="请输入您的手机号码" /><input type="button" id="btnCode" value="获取验证码"/></li>
            <li><label>验证码</label><input type="tel" name="code" placeholder="请输入验证码"></li>
        </ul>
    </div>
    <div class="login-tj login-zc login-button2" id="login-xia">下一步</div>
    <div class="login-login04">
        <ul>
            <li id="login-yzc2" class="login-zhuce"><a href="javascript:void(0);">已注册,直接登录</a></li>
        </ul>
    </div>
</div>
<div class="login-zhuce-suc login-wai wow  " data-wow-delay="-0.5s">
    <div class="swiper-slide">
        <div class=" login-zhuce2">
            <ul>
                <li><label>密码</label><input type="password"  name="password" id="zc_pwd" placeholder="请输入6位以上登录密码"></li>
                <li><label>姓名</label><input type="text" name="name" id="zc_name" placeholder="请输入您的姓名"></li>
                <li class="zhuce-border">
                	<label>性别</label>
                	<select id="zc_sex">
                	<option value="">请选择</option>
                	<option value="1">男</option>
                	<option value="2">女</option>
                	</select>
                </li>
            </ul>
        </div>
        <div class="login-tj login-zc login-button2" id="login-zc">注册完成!</div>
        <div class="swiper-pagination swiper-pagination-white"></div>
    </div>
</div>
<script src="{lanrain::RES}/js/wow.min.js"></script>
<script>
$(function(){
	var registerId = "<?php echo $registerId; ?>";
	var type = "<?php echo $type; ?>";
	if(type == 1){
		$('title').text('注册');
		$('.swiper-lizc').show().addClass('fadeInRightBig').css("z-index","4");
	    $('.login-deng').css('z-index','3').removeClass('fadeInRightBig');
	    $('.login-zhuce-suc').css('z-index','3').removeClass('fadeInRightBig');
	    $('.login-wjma').css('z-index','2').removeClass('fadeInRightBig');
	}
	if(registerId && type == 2){  // 找回密码
        $('title').text('忘记密码');
        $('.login-wjma').show().addClass('fadeInRightBig').css("z-index","4");
	    $('.login-deng').css('z-index','3').removeClass('fadeInRightBig');
	    $('.swiper-lizc').css('z-index','3').removeClass('fadeInRightBig');
	    $('.login-zhuce-suc').css('z-index','2').removeClass('fadeInRightBig');
	}
	$('#login-wjma').click(function(){
		$('title').text('忘记密码');
        $('.login-wjma').show().addClass('fadeInRightBig').css("z-index","4");
        $('.login-deng').css('z-index','3').removeClass('fadeInRightBig');
        $('.swiper-lizc').css('z-index','2').removeClass('fadeInRightBig');
        $('.login-zhuce-suc').css('z-index','1').removeClass('fadeInRightBig');
    });
	$('#login-zhuc').click(function(){
    	$('title').text('注册');
    	$('.swiper-lizc').show().addClass('fadeInRightBig').css("z-index","4");
        $('.login-deng').css('z-index','3').removeClass('fadeInRightBig');
        $('.login-zhuce-suc').css('z-index','3').removeClass('fadeInRightBig');
        $('.login-wjma').css('z-index','2').removeClass('fadeInRightBig');
    });
    $('#login-xia').click(function(){
    	$('title').text('注册');
        //$('.login-zhuce-suc').show().addClass('fadeInRightBig').css("z-index","4");  //
        $('.login-deng').css('z-index','1').removeClass('fadeInRightBig');
        $('.login-wjma').css('z-index','1').removeClass('fadeInRightBig');
        $('.swiper-lizc').css('z-index','1').removeClass('fadeInRightBig');
    });
    $('#login-yzc').click(function(){
    	$('title').text('登录');
        $('.login-deng').show().addClass('fadeInRightBig').css("z-index","4");
        $('.login-zhuce-suc ').css('z-index','1').removeClass('fadeInRightBig');
        $('.login-wjma').css('z-index','3').removeClass('fadeInRightBig');
        $('.swiper-lizc ').css('z-index','2').removeClass('fadeInRightBig');
    });
    $('#login-yzc2').click(function(){
    	$('title').text('登录');
        $('.login-deng').show().addClass('fadeInRightBig').css("z-index","4");
        $('.login-zhuce-suc').css('z-index','1').removeClass('fadeInRightBig');
        $('.login-wjma').css('z-index','3').removeClass('fadeInRightBig');
        $('.swiper-lizc').css('z-index','3').removeClass('fadeInRightBig');
    });
});
</script>
<script>
    new WOW().init();
</script>
<script>


$(function(){
// 控制“登录”按钮是否点亮
$('#importing-goods').keyup(function(){
	verificationLogin();
});
$('#importing-tel').keyup(function(){
	verificationLogin();
});
function verificationLogin(){
	var password = $('input[name="password"]').val();  
	var phone = $('input[name="moblie"]').val();
	if( phone.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(phone) && /^([a-zA-Z0-9_]){6,21}$/.test(password)){
	 	$(".login-login03").removeClass("login-button2").addClass("login-button");
	}else{
 		$(".login-login03").removeClass("login-button").addClass("login-button2");
 	}
}
//登录
$(".login-login03").on("click", function(){
	var openid = "<?php echo $openid; ?>";
	var phone = $('input[name="moblie"]').val();
	var pwd = $('#importing-goods').val();
	//var type = 'login';
	if(phone.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(phone) && /^([a-zA-Z0-9_]){6,21}$/.test(pwd)){
		//get(phone,pwd,type);
		$('.loading').show();
		$.post("<?php echo U('Login/login',array('companyid'=>$companyid)).'&time=';?>"+Math.random(),{openid: openid,moblie: phone,password: pwd},function(data){
			if(data.code == 200){
				$('.loading').hide();
				alert(data.tips,3000);
				window.location.href="<?php if(session('historyUrl') && (strpos(session('historyUrl'),'login') ===FALSE) && !(strpos(session('historyUrl'),'companyid='.$companyid) ===FALSE)){ echo session('historyUrl'); }else{ echo U('Member/center',array('companyid'=>$companyid)); } ?>";
			}else{
				$('.loading').hide();
				alert(data.tips,2000);
			}
		},"json");
	}	
});

// 忘记密码
$("#zhmm-moblie").keyup(function(){ wjmmCheck(); });
$("#zhmm-yym").keyup(function(){ wjmmCheck(); });
$("#zhmm-pwd").keyup(function(){ wjmmCheck(); });
function wjmmCheck(){
	var moblie = $("#zhmm-moblie").val();
	var code = $("#zhmm-yym").val();
	var pwd = $("#zhmm-pwd").val();
	if(moblie.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie) && code.length == 6 && /^([a-zA-Z0-9_]){6,21}$/.test(pwd)){
		$("#zhmm-substr").removeClass("login-button2").addClass("login-button");
	}else{
		$("#zhmm-substr").removeClass("login-button").addClass("login-button2");
	}
}

// 修改密码
$("#zhmm-substr").on('click',function(){
	var moblie = $("#zhmm-moblie").val();
	var code = $("#zhmm-yym").val();
	var pwd = $("#zhmm-pwd").val();
	if(moblie.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie)){
		if(code.length==6){
			if(/^([a-zA-Z0-9_]){6,21}$/.test(pwd)){
				$('.loading').show();
				$.post("<?php echo U('Login/forget_pw',array('companyid'=>$companyid)).'&time=';?>"+Math.random(),{moblie: moblie,password: pwd, code: code},function(data){
					if(data.code == 200){
						$('.loading').hide();
						alert(data.tips,3000);
						window.location.href="<?php if(session('historyUrl') && (strpos(session('historyUrl'),'login') ===FALSE) && !(strpos(session('historyUrl'),'companyid='.$companyid) ===FALSE)){ echo session('historyUrl'); }else{ echo U('Member/center',array('companyid'=>$companyid)); } ?>";
					}else{
						$('.loading').hide();
						alert(data.tips,2000);
					}
					},"json");	
			}else{
				alert('请输入6-21位，由大小写字母、数字组成的登录密码',3000);
			}
		}else{
			alert('请输入正确的6位验证码',3000);
		}
	}else{
		alert("请输入正确的手机号",3000);
	}
	
});
// 注册
// 获取注册验证码
$("#btnCode").on('click',function(){
	var moblie = $('#regiMoblie').val();
	var $this = this;
    if(moblie.length > 0){
    	if(/^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie)){
    		$('.loading').show(); 
    		$.post("<?php echo U('Login/iegiCode',array('companyid'=>$companyid)).'&time=';?>"+Math.random(),{moblie: moblie},function(data){
    	        if(data.code == 200){
    	        	$('.loading').hide();
    	        	time($this);
    	        	alert(data.tips);
    	        }else if(data.code == 300){
    	        	$('.loading').hide();
    	        	alert(data.tips,3000);
    	        }
    	    },"json");
    	}else{
    		alert("请填写正确的手机号",2000);
    	}
    }else{
    	alert("请填写手机号",2000);
    }
});
//控制“下一步”按钮是否点亮
$("#regiMoblie").keyup(function(){
	verificationRegi();
});
$("input[name='code']").keyup(function(){ 
	verificationRegi();	
});
function verificationRegi(){
	var moblie = $("#regiMoblie").val();
	var code = $("input[name='code']").val();
	if(moblie.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie) && code.length == 6){
		$("#login-xia").removeClass("login-button2").addClass("login-button");
	}else{
		$("#login-xia").removeClass("login-button").addClass("login-button2");
	}
};
$("#login-xia").on('click',function(){
	var moblie = $("#regiMoblie").val();
	var code = $("input[name='code']").val();
	if(moblie.length>0 && /^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie) && code.length == 6){
		$('.loading').show();
		$.post("<?php echo U('Login/ajaxIegiCode',array('companyid'=>$companyid)).'&time='; ?>"+Math.random(),{moblie:moblie, code:code},function(data){
	    	if(data.code == 200){
	    		$('.loading').hide();
	    	    $('.login-zhuce-suc').show().addClass('fadeInRightBig').css("z-index","4");
	    	}else{
	    		$('.loading').hide();
	    	    alert(data.tips,3000);
	    	}
    	},"json");
	}
});
//注册完成
$("#zc_pwd").keyup(function(){ zcPub(); });
$("#zc_name").keyup(function(){ zcPub(); });
//$(".zhuce-border").click(function(){ zcPub(); });
$("#zc_sex").change(function(){ zcPub(); });
function zcPub(){
	var pwd = $("#zc_pwd").val();
	var name = $("#zc_name").val();
	var sex = $("#zc_sex").val();
	if( /^([a-zA-Z0-9_]){6,21}$/.test(pwd) && name.length>0 && sex>0){
		$("#login-zc").removeClass("login-button2").addClass("login-button");
	}else{
		$("#login-zc").removeClass("login-button").addClass("login-button2");
	}
}
// 点击注册
$("#login-zc").on('click',function(){
	var registerId = "<?php echo $registerId;?>";
	var openid = "<?php echo $openid;?>";
	var token = "<?php echo $token;?>";
	var moblie = $("#regiMoblie").val();
	var code = $("input[name='code']").val();
	var pwd = $("#zc_pwd").val(); 
	var name = $("#zc_name").val();
	var sex = $("#zc_sex").val();
	if(/^([a-zA-Z0-9_]){6,21}$/.test(pwd)){
		if(name.length>0 && sex>0){
			$('.loading').show();
			$.post("<?php echo U('Login/register',array('companyid'=>$companyid,'mid'=>$mid)).'&time='; ?>"+Math.random(),{registerId:registerId,openid:openid,token:token,moblie:moblie,code:code,password:pwd,name:name,sex:sex},function(data){
				if(data.code == 200){
					$('.loading').hide();
					alert(data.tips,3000);
					window.location.href="<?php if(session('historyUrl') && (strpos(session('historyUrl'),'login') ===FALSE) && !(strpos(session('historyUrl'),'companyid='.$companyid) ===FALSE)){ echo session('historyUrl'); }else{ echo U('Member/center',array('companyid'=>$companyid)); } ?>";
				}else{
					$('.loading').hide();
					alert(data.tips,3000);
				}
			},"json");	
		}
	}else{
		alert("请输入6-21位，由大小写字母、数字组成的登录密码",3000);
	}
});
});
</script>
<script type="text/javascript">
    var wait=60;
    function time(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.value="获取验证码";
            wait = 60;
        } else {
            o.setAttribute("disabled", true);
            o.value="重新发送(" + wait + ")";
            wait--;
            setTimeout(function() {
                        time(o)
                    },
                    1000)
        }
    }
    // 点击获取（忘记密码）验证码
    $("#wjmm_hqyzm").on('click',function(){
    	   var moblie = $("#zhmm-moblie").val();
    	   var $this =this;
    	   if(moblie.length>0){
    	      if(/^(((13[0-9]{1})|(15[012356789]{1})|(17[0678]{1})|(18[0-9]{1}))+\d{8})$/.test(moblie)){
    	   	  	  $('.loading').show();
    	    	  $.post("<?php echo U('Login/mobileCode',array('companyid'=>$companyid)).'&time='; ?>"+Math.random(),{mobile:moblie},function(data){
    	  	          if(data.code == '200'){
    	  	        	  $('.loading').hide();
    	  	        	  alert(data.tips,3000);
    	  	        	  time($this);
    	  	           }else if(data.code == '300'){
    	  	        	  $('.loading').hide();
    	  	        	  alert(data.tips,3000);
    	  	           }
    	  	      },"json");    
    	      }else{
    	    	  $('.loading').hide();
    	    	  alert("请填写正确的手机号",3000);
    	      }
    	   }else{
    		   $('.loading').hide();
    		   alert("请填写手机号",3000);
    	   }
    });
</script>
<include file="Public:loading"/>
<include file="Public:weiXinNotShareSet"/>
</body>
</html>